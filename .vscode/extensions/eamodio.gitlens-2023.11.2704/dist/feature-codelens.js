exports.id=477,exports.ids=[477],exports.modules={5183:(e,n,t)=>{t.d(n,{GitCodeLensProvider:()=>y});var i=t(9496),s=t(2540),a=t(5255),o=t(6503),r=t(9529),l=t(5148),m=t(9796),c=t(3105),u=t(4336),d=t(4627),g=t(2509);class h extends i.CodeLens{constructor(e,n,t,i,s,a,o,r,l,m){super(r,m),this.languageId=e,this.symbol=n,this.uri=t,this.dateFormat=i,this.blame=s,this.blameRange=a,this.isFullRange=o,this.desiredCommand=l}getBlame(){return this.blame?.()}}class b extends i.CodeLens{constructor(e,n,t,i,s,a,o,r){super(o),this.languageId=e,this.symbol=n,this.uri=t,this.blame=i,this.blameRange=s,this.isFullRange=a,this.desiredCommand=r}getBlame(){return this.blame()}}class y{constructor(e){this.container=e}static selector=[{scheme:a.sN.File},{scheme:a.sN.Git},{scheme:a.sN.GitLens},{scheme:a.sN.PRs},{scheme:a.sN.Vsls},{scheme:a.sN.VslsScc},{scheme:a.sN.Virtual},{scheme:a.sN.GitHub}];_onDidChangeCodeLenses=new i.EventEmitter;get onDidChangeCodeLenses(){return this._onDidChangeCodeLenses.event}reset(e){this._onDidChangeCodeLenses.fire()}async provideCodeLenses(e,n){let t,s;if(e.isDirty&&(0,g.pt)(e.uri))return[];let a=await this.container.tracker.getOrAdd(e);if(!a.isBlameable)return[];let o=!1;if(e.isDirty){if(a.isDirtyIdle){let n=l.D.get("advanced.blame.sizeThresholdAfterEdit");n>0&&e.lineCount>n&&(o=!0)}else o=!0}let c=l.D.get("codeLens",e),d={...c.scopesByLanguage?.find(n=>n.language?.toLowerCase()===e.languageId)};null==d&&(d={language:e.languageId}),null==d.scopes&&(d.scopes=c.scopes),null==d.symbolScopes&&(d.symbolScopes=c.symbolScopes),d.symbolScopes=null!=d.symbolScopes?d.symbolScopes=d.symbolScopes.map(e=>e.toLowerCase()):[];let y=[],C=a.uri;if(o){if(1!==d.scopes.length||!d.scopes.includes("document")){let n;if([n,s]=await Promise.all([this.container.git.isTracked(C),(0,r.dO)("vscode.executeDocumentSymbolProvider",e.uri)]),!n)return y}}else if(n.isCancellationRequested||(1===d.scopes.length&&d.scopes.includes("document")?t=await this.container.git.getBlame(C,e):[t,s]=await Promise.all([this.container.git.getBlame(C,e),(0,r.dO)("vscode.executeDocumentSymbolProvider",e.uri)]),null==t||t?.lines.length===0))return y;if(n.isCancellationRequested)return y;let S=(0,m.IH)(()=>e.validateRange(new i.Range(0,0,1e6,1e6))),p=o?{command:void 0,title:this.getDirtyTitle(c)}:void 0;if(void 0!==s)for(let n of(u.Yd.log("GitCodeLensProvider.provideCodeLenses:",`${s.length} symbol(s) found`),s))this.provideCodeLens(y,e,n,d,S,t,C,c,o,p);if((d.scopes.includes("document")||d.symbolScopes.includes("file"))&&!d.symbolScopes.includes("!file")&&null==y.find(e=>0===e.range.start.line&&0===e.range.end.line)){let n;let s=S();if(o||c.recentChange.enabled){o||(n=(0,m.IH)(()=>this.container.git.getBlameRange(t,C,s)));let a=new i.SymbolInformation(C.fileName,i.SymbolKind.File,"",new i.Location(C.documentUri(),new i.Range(0,0,0,s.start.character)));y.push(new h(e.languageId,a,C,c.dateFormat,n,s,!0,I(a),c.recentChange.command,p))}if(!o&&c.authors.enabled){void 0===n&&(n=(0,m.IH)(()=>this.container.git.getBlameRange(t,C,s)));let a=new i.SymbolInformation(C.fileName,i.SymbolKind.File,"",new i.Location(C.documentUri(),new i.Range(0,1,0,s.start.character)));y.push(new b(e.languageId,a,C,n,s,!0,I(a),c.authors.command))}}return y}getValidateSymbolRange(e,n,t,s){let a,o=!1,r=i.SymbolKind[e.kind].toLowerCase();switch(e.kind){case i.SymbolKind.File:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(o=!n.symbolScopes.includes(`!${r}`)),o&&(a=t());break;case i.SymbolKind.Package:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(o=!n.symbolScopes.includes(`!${r}`)),o&&0===(a=I(e)).start.line&&0===a.end.line&&(a=t());break;case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Struct:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(a=I(e),o=!n.symbolScopes.includes(`!${r}`)&&(s||!a.isSingleLine));break;case i.SymbolKind.Constructor:case i.SymbolKind.Enum:case i.SymbolKind.Function:case i.SymbolKind.Method:case i.SymbolKind.Property:(n.scopes.includes("blocks")||n.symbolScopes.includes(r))&&(a=I(e),o=!n.symbolScopes.includes(`!${r}`)&&(s||!a.isSingleLine));break;case i.SymbolKind.String:(n.symbolScopes.includes(r)||"markdown"===n.language&&n.scopes.includes("containers"))&&(a=I(e),o=!n.symbolScopes.includes(`!${r}`)&&(s||!a.isSingleLine));break;default:n.symbolScopes.includes(r)&&(a=I(e),o=!n.symbolScopes.includes(`!${r}`)&&(s||!a.isSingleLine))}return o?a??I(e):void 0}provideCodeLens(e,n,t,s,a,o,r,l,c,u){try{let d;let g=this.getValidateSymbolRange(t,s,a,l.includeSingleLineSymbols);if(void 0===g)return;let y=n.lineAt(I(t).start);if(e.length&&e[e.length-1].range.start.line===y.lineNumber)return;let C=0;if((c||l.recentChange.enabled)&&(c||(d=(0,m.IH)(()=>this.container.git.getBlameRange(o,r,g))),e.push(new h(n.languageId,t,r,l.dateFormat,d,g,!1,y.range.with(new i.Position(y.range.start.line,C)),l.recentChange.command,u)),C++),l.authors.enabled){let s=!g.isSingleLine;if(!s&&"csharp"===n.languageId)switch(t.kind){case i.SymbolKind.File:break;case i.SymbolKind.Package:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Constructor:case i.SymbolKind.Method:case i.SymbolKind.Function:case i.SymbolKind.Enum:s=!0}s&&!c&&(void 0===d&&(d=(0,m.IH)(()=>this.container.git.getBlameRange(o,r,g))),e.push(new b(n.languageId,t,r,d,g,!1,y.range.with(new i.Position(y.range.start.line,C)),l.authors.command)))}}finally{if(K(t))for(let i of t.children)this.provideCodeLens(e,n,i,s,a,o,r,l,c,u)}}resolveCodeLens(e,n){return e instanceof h?this.resolveGitRecentChangeCodeLens(e,n):e instanceof b?this.resolveGitAuthorsCodeLens(e,n):Promise.reject(void 0)}resolveGitRecentChangeCodeLens(e,n){let t=e.getBlame();if(null==t)return $("Unknown, (Blame failed)",e);let a=(0,c.Ps)(t.commits.values());if(null==a)return $("Unknown, (Blame failed)",e);let o=`${a.author.name}, ${null==e.dateFormat?a.formattedDate:a.formatDate(e.dateFormat)}`;if(l.D.get("debug")&&(o+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Commit (${a.shortSha})]`),!1===e.desiredCommand)return $(o,e);switch(e.desiredCommand){case s.N4.CopyRemoteCommitUrl:return S(o,e,a,!0);case s.N4.CopyRemoteFileUrl:return p(o,e,a,!0);case s.N4.DiffWithPrevious:return C(o,e,a);case s.N4.OpenCommitOnRemote:return S(o,e,a);case s.N4.OpenFileOnRemote:return p(o,e,a);case s.N4.RevealCommitInView:return f(o,e,a);case s.N4.ShowCommitsInView:return N(o,e,t,a);case s.N4.ShowQuickCommitDetails:return v(o,e,a);case s.N4.ShowQuickCommitFileDetails:return w(o,e,a);case s.N4.ShowQuickCurrentBranchHistory:return F(o,e);case s.N4.ShowQuickFileHistory:return R(o,e);case s.N4.ToggleFileBlame:return L(o,e);case s.N4.ToggleFileChanges:return k(o,e,a);case s.N4.ToggleFileChangesOnly:return k(o,e,a,!0);case s.N4.ToggleFileHeatmap:return D(o,e);default:return e}}resolveGitAuthorsCodeLens(e,n){let t=e.getBlame();if(null==t)return $("? authors (Blame failed)",e);let a=t.authors.size,o=c.Ps(t.authors.values())?.name??"Unknown",r=`${(0,d._6)("author",a,{zero:"?"})} (${o}${a>1?" and others":""})`;if(l.D.get("debug")&&(r+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Authors (${(0,c.v_)((0,c.UI)(t.authors.values(),e=>e.name),", ")})]`),!1===e.desiredCommand)return $(r,e);let m=(0,c.sE)(t.commits.values(),e=>e.author.name===o)??(0,c.Ps)(t.commits.values());if(null==m)return $(r,e);switch(e.desiredCommand){case s.N4.CopyRemoteCommitUrl:return S(r,e,m,!0);case s.N4.CopyRemoteFileUrl:return p(r,e,m,!0);case s.N4.DiffWithPrevious:return C(r,e,m);case s.N4.OpenCommitOnRemote:return S(r,e,m);case s.N4.OpenFileOnRemote:return p(r,e,m);case s.N4.RevealCommitInView:return f(r,e,m);case s.N4.ShowCommitsInView:return N(r,e,t);case s.N4.ShowQuickCommitDetails:return v(r,e,m);case s.N4.ShowQuickCommitFileDetails:return w(r,e,m);case s.N4.ShowQuickCurrentBranchHistory:return F(r,e);case s.N4.ShowQuickFileHistory:return R(r,e);case s.N4.ToggleFileBlame:return L(r,e);case s.N4.ToggleFileChanges:return k(r,e,m);case s.N4.ToggleFileChangesOnly:return k(r,e,m,!0);case s.N4.ToggleFileHeatmap:return D(r,e);default:return e}}getDirtyTitle(e){return e.recentChange.enabled&&e.authors.enabled?l.D.get("strings.codeLens.unsavedChanges.recentChangeAndAuthors"):e.recentChange.enabled?l.D.get("strings.codeLens.unsavedChanges.recentChangeOnly"):l.D.get("strings.codeLens.unsavedChanges.authorsOnly")}}function C(e,n,t){return n.command=(0,r._N)({title:e,command:a.Gh.DiffWithPrevious,arguments:[void 0,{commit:t,uri:n.uri.toFileUri()}]}),n}function S(e,n,t,i=!1){return n.command=(0,r._N)({title:e,command:a.Gh.OpenOnRemote,arguments:[{resource:{type:o.J.Commit,sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function p(e,n,t,i=!1){return n.command=(0,r._N)({title:e,command:a.Gh.OpenOnRemote,arguments:[{resource:{type:o.J.Revision,fileName:t.file?.path??"",sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function f(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.RevealCommitInView,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function N(e,n,t,i){let s;return s=void 0===i?[...(0,c.DZ)(t.commits.values(),e=>e.isUncommitted?void 0:e.ref)]:[i.ref],n.command=(0,r._N)({title:e,command:0===s.length?"":a.Gh.ShowCommitsInView,arguments:[{repoPath:t.repoPath,refs:s}]}),n}function v(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.ShowQuickCommitDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function w(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.ShowQuickCommitFileDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function F(e,n){return n.command=(0,r._N)({title:e,command:s.N4.ShowQuickCurrentBranchHistory,arguments:[n.uri.toFileUri()]}),n}function R(e,n){return n.command=(0,r._N)({title:e,command:s.N4.ShowQuickFileHistory,arguments:[n.uri.toFileUri(),{range:n.isFullRange?void 0:n.blameRange}]}),n}function L(e,n){return n.command=(0,r._N)({title:e,command:a.Gh.ToggleFileBlame,arguments:[n.uri.toFileUri()]}),n}function k(e,n,t,i){return n.command=(0,r._N)({title:e,command:a.Gh.ToggleFileChanges,arguments:[n.uri.toFileUri(),{type:"changes",context:{sha:t.sha,only:i,selection:!1}}]}),n}function D(e,n){return n.command=(0,r._N)({title:e,command:a.Gh.ToggleFileHeatmap,arguments:[n.uri.toFileUri()]}),n}function $(e,n){return n.command={title:e,command:""},n}function I(e){return K(e)?e.range:e.location.range}function K(e){return(0,m.is)(e,"children")}}};