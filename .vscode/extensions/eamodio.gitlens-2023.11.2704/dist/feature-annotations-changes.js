exports.id=817,exports.ids=[817],exports.modules={34:(e,t,r)=>{r.d(t,{GutterChangesAnnotationProvider:()=>m});var i=r(9496),o=r(1062),n=r(5148),s=r(4241),a=r(6004),l=r(7469),u=r(6398),c=r(2022),h=r(623),d=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),v=(e,t,r)=>{if(null!=t){var i;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected");if(r&&(i=t[f("asyncDispose")]),void 0===i&&(i=t[f("dispose")]),"function"!=typeof i)throw TypeError("Object not disposable");e.push([r,i,t])}else r&&e.push([r]);return t},g=(e,t,r)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,t,r,i){return(i=Error(r)).name="SuppressedError",i.error=e,i.suppressed=t,i},o=e=>t=r?new i(e,t,"An error was suppressed during disposal"):(r=!0,e),n=i=>{for(;i=e.pop();)try{var s=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(s).then(n,e=>(o(e),n()))}catch(e){o(e)}if(r)throw t};return n()};class m extends c.H{constructor(e,t,r){super("changes",e,t),this.container=r}state;hoverProviderDisposable;mustReopen(e){return this.annotationContext?.sha!==e?.sha||this.annotationContext?.only!==e?.only}clear(){this.state=void 0,null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}selection(e){return Promise.resolve()}validate(){return Promise.resolve(!0)}async onProvideAnnotation(e){var t=[];try{let r,o;let n=(0,a.UH)();this.mustReopen(e)&&this.clear(),this.annotationContext=e;let s=this.trackedDocument.uri.sha,c=e?.sha!=null&&e.sha!==s?`${e.sha}^`:void 0,d=null==s&&null==c;if(d){let e=await this.container.git.getOldestUnpushedRefForFile(this.trackedDocument.uri.repoPath,this.trackedDocument.uri);if(null!=e)e=`${e}^`,r=await this.container.git.getCommitForFile(this.trackedDocument.uri.repoPath,this.trackedDocument.uri,{ref:e}),null!=r?null!=c?c=e:(s=e,c=""):d=!1;else{let e=await this.container.git.getStatusForFile(this.trackedDocument.uri.repoPath,this.trackedDocument.uri),t=e?.getPseudoCommits(this.container,await this.container.git.getCurrentUser(this.trackedDocument.uri.repoPath));t?.length?(r=await this.container.git.getCommitForFile(this.trackedDocument.uri.repoPath,this.trackedDocument.uri),s="HEAD"):this.trackedDocument.dirty?s="HEAD":d=!1}}if(!d){if(r=await this.container.git.getCommitForFile(this.trackedDocument.uri.repoPath,this.trackedDocument.uri,{ref:c??s}),null==r)return!1;null!=c||(s=`${r.ref}^`),c=r.ref}let p=(await Promise.allSettled(null==c&&this.editor.document.isDirty?[this.container.git.getDiffForFileContents(this.trackedDocument.uri,s,this.editor.document.getText()),this.container.git.getDiffForFile(this.trackedDocument.uri,s,c)]:[this.container.git.getDiffForFile(this.trackedDocument.uri,s,c)])).map(e=>(0,l.Sb)(e)).filter(e=>!!e);if(!p?.length)return!1;let f=v(t,(0,u.k)(n)),g=new Map,m=e?.sha!=null&&e?.only?await this.container.git.getBlame(this.trackedDocument.uri,this.editor?.document):void 0;for(let t of p)for(let r of t.hunks){if(null!=m){let t=!0,i=e.sha;for(let e=r.current.position.start-1;e<r.current.position.end;e++)m.lines[e]?.sha===i&&(t=!1);if(t)continue}for(let[e,t]of r.lines){if("unchanged"===t.state)continue;let r=this.editor.document.validateRange(new i.Range(new i.Position(e-1,0),new i.Position(e-1,1073741824)));null==o&&(o=new i.Selection(r.start,r.end));let n=g.get(t.state);null==n?(n={decorationType:"added"===t.state?h.I.changesLineAddedAnnotation:"removed"===t.state?h.I.changesLineDeletedAnnotation:h.I.changesLineChangedAnnotation,rangesOrOptions:[{range:r}]},g.set(t.state,n)):n.rangesOrOptions.push({range:r})}}return f?.restart({suffix:" to compute recent changes annotations"}),g.size&&(this.setDecorations([...g.values()]),f?.stop({suffix:" to apply all recent changes annotations"}),null!=o&&e?.selection!==!1&&(this.editor.selection=o,this.editor.revealRange(o,i.TextEditorRevealType.InCenterIfOutsideViewport))),this.state={commit:r,diffs:p},this.registerHoverProvider(),!0}catch(e){var r=e,o=!0}finally{g(t,r,o)}}registerHoverProvider(){let e=n.D.get("hovers");e.enabled&&e.annotations.enabled&&(this.hoverProviderDisposable=i.languages.registerHoverProvider({pattern:this.document.uri.fsPath},{provideHover:(e,t,r)=>this.provideHover(e,t,r)}))}async provideHover(e,t,r){if(null==this.state||"line"!==n.D.get("hovers.annotations.over")&&0!==t.character)return;let{commit:s,diffs:a}=this.state;for(let r of a)for(let n of r.hunks){let r=n.previous.count>n.current.count;if(t.line>=n.current.position.start-1&&t.line<=n.current.position.end-(r?0:1)){let a=await (0,o.yq)(s,this.trackedDocument.uri,t.line,n);if(null==a)return;return new i.Hover(a,e.validateRange(new i.Range(n.current.position.start-1,0,n.current.position.end-(r?0:1),1073741824)))}}}}((e,t,r,i)=>{for(var o,n=i>1?void 0:i?p(t,r):t,s=e.length-1;s>=0;s--)(o=e[s])&&(n=(i?o(t,r,n):o(n))||n);return i&&n&&d(t,r,n)})([(0,s.cM)()],m.prototype,"onProvideAnnotation",1)}};